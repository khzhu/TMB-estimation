process {
    cpus = 16
    memory = 64.GB
    withName: BWA_MEM {
        container = "${params.container_dir}/bwa-samtools-v0.7.17.simg"
        ext.args = ' -M -v 1 -K 100000000 '
        ext.prefix = { "${meta.id}.sort" }
        publishDir = [
                path: { "${params.output_dir}/alignments/" },
                mode: params.publish_dir_mode,
                pattern: "*.{bam,cram,crai,yml}",
                saveAs: { "bwa/${meta.id}/${it}" }
        ]
    }
    withName: SAMBAMBA_MARKDUP {
        container = "${params.container_dir}/sambamba-1.0.1.simg"
        ext.args = ' --remove-duplicates --hash-table-size 525000 --overflow-list-size 525000 '
        ext.prefix = { "${meta.id}.sort.dedup" }
        publishDir = [
                path: { "${params.output_dir}/alignments/" },
                mode: params.publish_dir_mode,
                pattern: "*.{bam,bai,yml}",
                saveAs: { "sambamba/${meta.id}/${it}" }
        ]
    }
    withName: SAMBAMBA_FLAGSTAT {
        container = "${params.container_dir}/sambamba-1.0.1.simg"
        publishDir = [
                path: { "${params.output_dir}/alignments/" },
                mode: params.publish_dir_mode,
                pattern: "*.{stats,yml}",
                saveAs: { "sambamba/stats/${meta.id}/${it}" }
        ]
    }
}